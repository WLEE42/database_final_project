{% extends "library/base.html" %}

{% block content %}
    {% load tz %}
    <h1>我的罚款</h1>
    <h4>总罚金：{{ pemoney }}</h4>

    {% if penalty_list %}
        <ul>
            {% for penalty_record in penalty_list %}
                <li>
                    {#                    <p>#}
                    {#                        <a href="{% url 'book-detail' penalty_record.bookcopy.book.bid %}">{{ penalty_record.bookcopy.book.bname }}#}
                    {#                            ({{ penalty_record.bookcopy.book.bauthor }})#}
                    {#                        </a>#}
                    {#                    </p>#}
                    <p>
                        {{ penalty_record.pemoney }}
                    </p>
                    <p>
                        {{ penalty_record.pedate }}
                    </p>
                    {% if penalty_record.isfinished %}
                        <p>已交罚金</p>
                    {% else %}
                        <p>未交罚金</p>
                        <button class="btn btn-primary" id="{{ penalty_record.pid }}">
                            交钱
                        </button>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>

    {% else %}
        <p>没有借书。</p>
    {% endif %}
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function () {
            $(":button").click(function () {
                $.ajax({
                    url: {% url 'penalty-pay' %},
                    type: "post",
                    data: {
                        "pid": this.id
                    },
                    dataType: 'json',
                    timeout: 20000,
                    success: function (data) {
                        {#window.clearInterval(timer)#}
                        alert("归还成功" + data['message'])
                    },
                    complete: function (data) {
                        {#window.clearInterval(timer)#}
                        {#alert("超时")#}
                    },
                    error: function (e) {
                        alert("错误" + e);
                        {#window.clearInterval(timer)#}
                    }
                })
            })
        })
    </script>
{% endblock %}
