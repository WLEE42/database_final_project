{% extends "library/base.html" %}

{% block content %}
    {% load tz %}
    <h1>我的预约</h1>

    {% if reserve_list %}
        <ul>
            {% for reserve_record in reserve_list %}
                <li>
                    <hr>
                    <div id="alert_placeholder{{ reserve_record.reid }}"></div>
                    <div class="row">
                        <div class="col-md-4">
                            {{ reserve_record.book.bname }}
                        </div>
                        <div class="col-md-4">
                            {{ reserve_record.book.bauthor }}
                        </div>
                        <div class="col-md-4">
                            {{ reserve_record.adddate }}
                        </div>
                    </div>
                    {% if reserve_record.isbookavailable %}
                        <p>书籍可以借阅</p>
                        <button class="btn btn-primary" id="{{ reserve_record.pid }}">
                            借阅
                        </button>
                    {% else %}
                        <p>书籍不可借阅</p>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>

    {% else %}
        <p>没有借书。</p>
    {% endif %}
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function () {
            $(".btn.btn-primary").click(function () {
                let reid = this.id
                $.ajax({
                    url: "{% url 'reserve-borrow' %}",
                    type: "post",
                    data: {
                        "reid": this.id
                    },
                    dataType: 'json',
                    timeout: 20000,
                    success: function (data) {
                        {#window.clearInterval(timer)#}
                        {#alert("归还成功" + data)#}
                        {#alert(data["message"])#}
                        {#showalert(data["message"], data["result"])#}
                        showalert(data["message"], data["result"], reid)
                    },
                    complete: function (data) {
                        {#window.clearInterval(timer)#}
                        {#alert("超时")#}
                    },
                    error: function (e) {
                        {#alert("错误" + e);#}
                        {#window.clearInterval(timer)#}
                    }
                })
            })
        })
    </script>
{% endblock %}
